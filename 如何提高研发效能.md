# 如何系统地理解研发效能

**研发效能，就是开发者是否能够长期既快又准地产生用户价值**。

开发者能够聚焦产出价值，更容易精进自己的技术。于是，团队容易建立起好的氛围，进而又能促进生产效率的提高，形成良性循环，支撑持续的高效开发

怎样才能有效地提高研发效能

做事时都遵循一些基本原则。比如，有一个原则是“不要阻塞开发人员”，贯穿在公司的很多研发和管理实践中

软件开发本质上就是一条超级灵活的流水线。这个流水线从产品需求出发，经过开发、测试、发布、运维等环节，每一个环节的产出流动到下一个环节进行处理，最后交付给用户。流水线的每个环节都还可以细分。

软件开发的灵活性

1、最终产品目标的灵活性。传统流水线的目标确定，而互联网产品的最终形态通常是在不断地迭代中逐步明确。在精益开发实践中，常常使用 MVP（最小可行性产品，Minimal ViableProduct）来不断验证产品假设，经过不断调整最终形成产品

2、节点之间关系的灵活性，比如流水线上的多个节点可以互相融合。DevOps 就是在模糊节点之间的边界，甚至有一些实践会直接去掉某些环节，或者融入到其他环节当中

3、每个节点的灵活性。每一个生产环节都会不断涌现出新的生产方式 / 方法。比如测试，最近十多年就产生了测试驱动开发、Dogfood（狗粮测试）、测试前移等方法；最近又出现的测试右移，开始强调在生产环境中进行测试

4、每个节点上的开发人员的灵活性。跟传统制造业不同，流水线上的每一个工作人员，也就是开发者，都有很强的灵活性，主要表现在对一个相同的功能，可以选择很多不同的方式、不同的工具来实现。

优化流程、团队工程实践、个人工程实践以及文化和管理，就是我们提高研发效能需要关注的四个方面，也就是我们所说的研发效能模型

# 效能度量

研发效能的度量，从应用程序开发的生命周期中获取数据，并使用这些数据来衡量软件开发人员的工作效率

要真正发挥度量的作用，找到合适的度量指标，必须先对指标进行分类。我推荐从团队和个人这两个维度对度量指标进行分类，其中团队维度中又分为速度、准确度和质量3 类，所以一共是 4 类

速度：速度指标主要用来衡量团队研发产品的速率。比如，前置时间，从任务产生到交付的时长

准确度：关注产品是否跟计划吻合，跟用户需求吻合，能否提供较大的用户价值。一个例子是功能的采纳率，也就是有百分之多少的用户使用了功能 x

质量：如果质量有问题，产品的商业价值会被大打折扣。质量包括产品的性能、功能、可靠性、安全等方面

个人效能：个人开发过程中的效率指标，比如开发环境生成速度、本地构建速度等

个人调测环境搭建速度、本地测试运行速度、开发/测试/UAT环境验证速度、开发环境生成速度、测试数据生产速度、开发环境满意度



效能度量的原则，原则是不要与绩效挂钩，而应该作为参考和工具，帮助团队提高效能

怎样才能使用度量提高效率？提供度量作参考和工具，帮助团队提高效能

效能度量的推荐方法

第一，目标驱动，度量对的事

 净推荐值 (Net Promoter Score，NPS)，是通过调研了解用户满意度，实用性很强

系统 /App 宕机时间 (System/App Downtime) 和严重线上事故数 (Incidents)，衡量
的是系统的可用性，通常与用户价值直接挂钩

热修复上线时间 (Hotfix Time)，指的是一个热修复从编码完成到部署到生产的时长，
关系到解决重大缺陷的效率，与用户价值强相关

第二，先从全局上找瓶颈，再深入细节

先检查全局，找到关键瓶颈之后，再进入细节分析和解决的环节

收集产品周期中每一个阶段所占用的时间，包括计划的时间和最后实际花费的时间，然后寻找问题最大的地方

具体的耗时收集方法，大致有两种：

1. 人工收集。比如，文章开头提到的项目经理手工收集研发过程中每环节的耗时。
2. 通过工具收集。比如，Trello 的任务显示看板，或者 Jira 的看板，都可以清楚地看到每
   个环节有多少任务以及流动情况，从而直观地识别瓶颈

收集到了每环节的耗时之后，下一步就是去发现瓶颈。除了直观的观察之外，我推荐一个工具：累积流程图（Cumulative Flow Diagram)。

第三，通过主观的方式来评价、提高效能

推荐收集人工反馈的办法，来帮助我们做出尽量公平的主观评价。

针对研发环境、流程、工具的效能进行评价，可以使用公司成员对研发效能满意度的净推荐值

针对个人研发效能作评价，可以采用类似 360 度绩效考评的方式来收集同事之间的评价。

第四，关注个人维度的指标提高效能

作为管理者 / 内部效能团队，应该关注开发人员的高频活动，并自动化和优化这些步骤，让开发人员能专注开发。

度量方法包括：目标驱动，度量对的事；先从全局上找瓶颈，再深入细节；通过主观的方式来评价、提高效能；关注个人维度的指标提高效能。

# 怎样才能让敏捷、精益真正为我所用

软件开发的最大特点在于它是一条非常灵活的流水线，因此提高研发效能的第一步就是优化流程

方法论实施效果不好，关键在于没用好

在学习方法论的时候，我推荐使用类似美国著名作家、企业顾问西蒙斯 · 涅克（SimonSinek）总结的 Why-How-What 黄金圈法则。

 Why，也就是这个方法论的目标，是要解决一个什么问题；第二个是 How，也就是这个方法论的基本原则、指导思想；第三个是 What，也就是这个方法论的具体实践。

我们必须首先深入理解这个方法论的目标和基本原则，然后根据原则因地制宜地选择具体实践。在选择具体实践时，往往需要在已有实践上做些修改才能达到效果，否则事倍功半

敏捷的目标是快速应对变化，而 Scrum 就是用来服务这个目标的。但是，很多团队在使用的时候，严格照搬 Scrum 的具体方法，而“严格照搬”本身就已经违背了敏捷的目标。

在引入实践的时候，建议是逐步优化已有的开发流程和框架，甚至只给出原则，让团队成员逐步摸索并最终找到合适的方法。

比如，你可以把一个核心原则通知给团队：“流程中总是有一个核心瓶颈。找到它，并解决它”

目标一：寻找用户价值

优化研发流程的第一步，就是提高寻找用户价值的效率

第一条原则是：衡量每一个时间段成果的标准，应该是价值假设方面的进展。也就是说，你的工作应该让你学习到如何更好地给用户提供价值，而不是开发了多少功能。

第二条原则是：使用最小可行性产品（Minium Viable Product，MVP）来帮助学习。

目标二：提高用户价值的流动效率

第一，让功能尽快地流动

说白了就是快速开发。问题发现得越晚，修复代价越高

要做到快速开发，开发人员需要尽量把功能拆分，同时做好一个提交之后尽快提
交。

第二，让节点之间的联动更加顺畅

个人代码上线后，在和他人的代码集成时容易出现问题，这时就可以使用 CI/CD（持续集成 / 持续交付）流水线来自动化代码集成过程

第三，节点之间的融合

也是为了保证节点间的联动顺畅。也就是模糊节点间的边界，让功能在节点之间的流动更顺畅。在这一方面，我见到比较有效的方式是：职能团队提供平台和工具，让全栈工程师能够自己处理端到端的工作。

第四，发现整个流程中的瓶颈，并解决它们

第一步，找到系统中的瓶颈；
第二步，最大限度地利用（Exploit）瓶颈，尽量通过提高效能的办法解决瓶颈；
第三步，让企业的所有其他活动都让步于瓶颈改善工作；
第四步，打破（Elevate）瓶颈，如果第二、三步无效，就通过给瓶颈节点增加资源的方法来解决瓶颈；
第五步，重返（Repeat）第一步，找出新的瓶颈，持续改善。

具体的实践有可视化和复盘

在可视化方面，粘上便利贴的白板，或是像 Trello 那样的电子看板就是很好的工具

真正的“看板”是信号卡片，用来表示流水线系统可以增加新的工作项了。通过任务可视化，我们可以直观地看到哪一个环节的任务特别多，卡住了，也就是瓶颈在哪儿

在复盘方面， 复盘系统，用来记录公司发生的重要事故进行复盘。每个团队也会不定期地复盘，以定位瓶颈问题并提高

# 如何让开发人员聚焦于开发

提高开发者编写代码的效能，关键在于让开发者不受阻塞、不受不必要的干扰，从而全身心地聚焦在产品开发上。我把这种不受阻塞的开发状态叫作持续开发。

持续开发的基本原则主要包括两条：规范化、自动化核心步骤和快速反馈，增量开发

## 规范化、自动化核心步骤

要让开发者聚焦于开发，就必须把研发流程中可以自动化的步骤尽量自动化

分析关键路径上的活动，以及耗时较长的活动，然后投入精力优化这些步骤

首先，我们需要明确具体的开发步骤有哪些

获取开发环境，包括获取开发机器、配置环境、获取代码等

## 提高开发环境的获取效率*

把整个开发环境的获取，进行服务化、自助化

开发者可以自助地申请获取环境，不需要 IT 部门的人员介入，从而既节省了开发者的时间，又降低了 IT 部门的人力成本。

在本地开发机器上进行开发，包括本地的编码、调测、单元测试等

代码入库前，把改动提交到检查中心（比如 Gerrit），再进行一轮系统检查，主要包括代码检查、单元测试、代码审查等，通过之后再入库

## 规范化、自动化化本地检查

本地检查是指，开发者在开发机器上进行的验证，比如语法检查、规范检查、单元测试、沙盒搭建等。

根据团队实际情况，找到合适的工具和配置进行这些检查，并让团队成员统一使用

## 建设并自动化代码入库前的检查流程

建设并自动化代码入库前的检查流程，是持续集成前的必要工作，对提高质量用处很大

除了人数非常少的初创公司以外，其他开发团队都应该进行这个配置。

一般可以使用代码仓管理系统作为中心，直接使用或者通过钩子集成其他工具和系统来实现

## 快速反馈，增量开发

指的是，能够快速验证已经完成的开发工作，说白了就是边开发边验证

灵活使用各种 Linter 和测试*

首先，用命令行的工具来封装各种检查

其次，以服务化的方式，把这些检查的能力提供出来

建设并优化沙盒环境*

=====================

使用实时检查工具

快速提供检查反馈，做到极致就是开发者无需手动触发检查，工具就会自动探测到改动、自动运行检查

最常见的是，IDE 中的实时语法检查

有些工具可以自动监视文件系统的变化，文件有变化时自动重启服务，比如SpringBoot 有 Spring-Boot-Devtools

**作为开发者，可以自己抽一点时间提高自己的工作流程，自动化繁琐的工作**

**而作为管理者，可以有意识地奖励这样的优化行为，并对适用于团队的部分进行推广**

# 如何使用CI-CD满足业务要求

持续集成（ContinuousIntegration, CI)、持续交付（Continuous Delivery, CD）和持续部署（ContinuousDeployment, CD)

持续集成的定义就是：在团队协作中，一天内多次将所有开发人员的代码合并入同一条主干

代码入库后，剩下工作是把代码编译打包成可以发布的形式，先发布到测试环境进行测试，再发布到类生产环境进行测试，最终部署到生产环境

持续交付的目标是，对每一个进入主干分支的代码提交，构建打包成为可以发布的产品;持续交付是一种软件工程方法，在短周期内完成软件产品，以保证软件保持在随时可以发布的状态

持续部署，则更进一步。它把持续交付产生的产品立即自动部署给用户，定义就是：将每一个代码提交，都构建出产品直接部署给用户使用

共同的本质是，让每一个变更都经过一条自动化的检验流水线，来检查每一个变更的质量，通过就进入下一个阶段。

具体的搭建方式，通常是持续集成工具 + 代码仓管理系统 + 检查工具 + 测试工具，比如Jenkins+GitLab+SonarQube+Linter+UnitTest 的组合

流水线的测试要尽量完整

CI/CD 流水线的测试只有尽量完整，代码和产品的质量才能有保证。所以，最主要的工程实践，就是在流水线中运行大量高质量的测试和检查。流水线的运行速度一定要快；

首先，从技术角度考虑。

​	使用并行方式运行各种测试来提速；

​	投入硬件资源，使用水平扩展的方式来提速；
​	使用增量测试的方式进行精准验证。也就是说，只运行跟当前改动最相关的测试，以减少测试用例的运行数量

其次，权衡流水线的运行速度、流水线资源和测试完整性的关系。

流水线使用的环境，尽量和生产环境一致。

这里的环境，包括机器环境、数据、软件包、网络环境等

软件包最好只构建一次，保证各种不同环境都用同一个包

使用 Docker 镜像的方式，把发布的产品以及环境都打包进去，实现环境的一致性

尽量使用干净的环境。

# DevOps、SRE

DevOps，Development 和 Operations 的组合词，是一种重视“软件开发人员（Dev）”和“IT 运维技术人员（Ops）”之间沟通合作的文化、活动或惯例。 通过自动化“软件交付”和“架构变更”的流程，使得软件的构建、测试、发布更加快捷、频繁和可靠。

SRE，全称是 Site Reliability Engineer ，网站可靠性工程师，是一个职位，是软件工程师和系统管理员的结合，主要目标是创建可扩展且高度可靠的软件系统。

DevOps 是打通开发和运维的文化和惯例，而 SRE 是 DevOps 的具体实践之一

DevOps 和 SRE 最初要解决的问题：开发和运维这两个角色的目标不一致，导致研发和上线流程的不顺畅，最终严重影响软件上线的效率。开发人员的职责是开发功能。功能上线越多，对团队和公司的贡献就越大。所以，开发人员倾向于多开发功能，并快速上线。而运维人员的主要职责是，上线功能，以及保证系统的稳定性，更关注系统的稳定性

怎么解决这个问题

原则 1：协调运维和开发人员的目标、利益

想办法让它们的目标、利益变得一致，是整个 DevOps 中最重要的一条

全栈开发，就是每一个工程人员的工作涵盖了不止一个领域。说白了，就是对产品结果负责，而不是只对某一个具体环节负责

第一，增加一个新的运维角色，用开发的方式去做运维。这种新型运维角色负责帮助开发人员推动业务快速开发、快速上线，具体工作包括：优化流程，提供自助工具

第二，修改开发人员的职责描述为，快速开发和上线稳定的高质量产品，让他们也参与到一部分运维工作中去。

原则 2：推动高效沟通

之所以强调推动高效沟通，就是为了解决开发和运维因为存在“部门墙”而导致的信息不流通的问题

设置聊天室（比如 IRC），用于沟通部署进展和问题

引入 ChatOps，也就是通过自动化的方式，提高部署相关的沟通。

把任务、代码提交、发布的关联关系，在工具中呈现出来，并提供比如任务看板、系统监控看板等可视化工具，显示开发、运维重点信息

原则 3：优化从开发到部署的整个上线流程

优化上线流程，主要目的是解决频繁上线工作量大、产品质量不稳定的问题

优化代码入库和部署上线流程，并最大化地利用工具来自动化流程

落地步骤推荐

DevOps 的本质是解决开发和运维之间的冲突，所以落地时首先要从人出发，然后是流程，最后才是工具

对团队目标达成共识，并重新定义职责

研发团队内部统一认识，主要是让团队成员明确我们的目标一致。同时在做绩效考评时，对大家的要求都是产品快速、高质量上线。

增加“发布工程师”角色，投入相当一部分精力去设计、优化产品的开发和上线流程，包括持续集成、持续交付、手动部署流程，以及问题监控流程和 Oncall 机制。

设计 CI、CD、快速反馈，以及团队沟通等流程

部署沟通流程是：建立了专门的聊天室沟通持续集成、持续交付，以及手动部署的进展情况，确保发布上线流程相关信息的顺畅流通

部署系统常见问题及解决办法收集流程是：在解决完线上问题之后，记录下问题的细节和解决步骤。很简单，就是因为很多问题会重复出现。每个人都可以更改、搜索这些记录，对后续解决问题帮助非常大

引入工具，实现自动化

DevOps 相关工具主要包括两大类：CI/CD 工具链和沟通工具

CI/CD：GitLab+CodeCI+AWS EC2

任务管理：Pivotal Tracker，MeisterTask

监控，分析:Fabric、MixPanel

Wiki、文档：Google Docs

问题讨论：邮件,MeisterTask、Slack

# 信息流通

## 团队成员愿意共享是有效沟通的前提

首先，要让团队成员了解信息的重要性。

要在团队内部建设机制，来鼓励共享的行为，从而形成共享的文化。

按照产品或者功能划分团队，让团队成员直接对产品或者功能负责

解决按照职能划分团队的沟通问题：使用虚拟团队，具体的办法是，给每个功能设计一个虚拟团队，包括产品、设计，以及相关的开发人员。之所以说是虚拟团队，是因为它并不存在于公司的正式组织架构里。我们明确这个团队的职责，就是要做好某个功能。给每个虚拟团队建立一个专门的聊天群，来沟通这个功能的相关问题。每周会收集每个虚拟团队的工作进展情况，以此来推动产品维度的进展。

## 信息共享与工具

第 1 种信息是，战略目标相关的信息

尽量公开。只有当团队成员清楚公司以及团队目标时，才能更容易地把自己的目标与之对齐

比如Facebook 每年都会召开一个员工大会，详细列举公司的战略目标；每周还会有一个 Q&A会议，每个员工都可以参加，马克 · 扎克伯格会亲自出席，并回答员工提出的各种问题。这些举措，都促进了员工对公司战略和目标的深入理解。

第 2 种信息是，代码相关的信息

所有的代码仓，都对全部开发人员公开

不但可以阅读其他团队的代码，还可以主动去修改、提高他们的代码，只要修改得当，发出的 PR 就会被接受。

选择共享代码的工具和方式，基本原则是方便查找，并在进行开发工作的主要入口（比如IDE、命令行工具、Web 浏览器）提供接口

第 3 种信息是，研发过程中用到的各种文档

包括产品设计文档、开发设计文档、测试文档、部署流程文档等

通过统一的工具，方便大家添加、修改、查询这些文档

Wiki 和 Quip 管理的文档

第 4 种信息是，各种标识信息

整个研发流程中，在各种工具之间流动着多种标识信息，包括任务工单、代码提交号、版本号、代码审查 ID、测试用例 ID、Bug ID 等

管理这一类信息的有效方法是，
各种工具通过提供 API，做到服务化，形成工具之间的网状连接，以方便开发人员在工具上快速拿到需要的各种信息

## 沟通方式技巧

根据沟通需要达成的任务的实时性、方便追溯性，以及对别人的干扰程度，选择合适的沟通工具

针对不同的情况，要求大家使用合适的工具去沟通，并逐渐形成习惯

对某个任务进行讨论时，最好是直接使用任务工具中的讨论功能，同时通过 @的方式来告知相关人员。而一般的工具都可以配置出现 @时，自动发邮件通知对方。所以，如果不是紧急任务，都可以采用这种方式

其次，在询问问题的时候，可以分以下 3 种情况，选择沟通方式和工具

如果问题不紧急，尽量使用邮件，避免使用即时聊天工具和电话。为了确保大家能够及时回复邮件，可以在团队内制定一个规定，要求检查邮件的频率，比如说每天至少检查一次或者两次

如果问题紧急，则直接使用即时聊天工具、电话

如果要讨论的问题比较复杂，或者是非常紧急，则直接选择电话，或者面对面沟通。

# 代码审查

代码审查是指代码作者以外的其他人对代码进行检查，以寻找代码的缺陷和可以提高的地方

代码审查可以分为工具辅助的线下异步审查和面对面审查两类

工具辅助的线下异步审查，就是代码作者通过工具将代码发送给审查者，审查者再通过工具把反馈传递给作者。比如，GitHub、GitLab、Gerrit、Phabricator 等工具的审查都是这种方式

面对面审查，就是审查者和代码作者在一块儿阅读代码，进行实时讨论

引入代码审查的步骤和方法

1、代码审查应该计入工作量

管理者要明确代码审查是开发工作的重要组成部分，并记入工作量和绩效考评。这，是成功引入代码审查的前提，再怎么强调都不为过

2、 选择试点团队

推荐先不要大范围实施，而是应该先选择试点团队，之后再推广。这样做的好处是，一方面，试点团队成员有限，容易推行新的做法；另一方面，有了试点团队的成功案例后，再全面推行就有了可借鉴的经验，会更顺畅。

关于试点团队的选择，最好是找成员经验丰富、对技术有追求，同时所做业务又不是最紧急的小团队

3、选择代码审查工具，并把机器审查和人工审查结合起来

使用 GitLab、Jenkins 和 SonarQube 进行配置。具体使用 GitLab 管理代码，代码入库后通过钩子触发 Jenkins，Jenkins 从 GitLab 获取代码，运行构建，并通过 Sonar 分析结果

成功推进代码审查的关键操作

操作一：提高提交的原子性

代码提交的原子性，是指一个提交包含一个不可分割的特性、修复或者优化，同时这个提交要尽可能小

一个实现原子性提交的技巧：在对一个大功能进行原子性拆分的时候，功能开关是一个很好的工具

操作二：提高提交说明的质量

提交说明是提高代码审查的利器

成功推行代码审查的两个关键原则

代码审查原则一：互相尊重

代码审查原则二：基于讨论

## 质量与速度的均衡

处理技术债的基本原则

第一方面，要利用技术债的好处，必要时要大胆“举债前行”

第二个方面，要控制技术债，在适当的时候偿还适当部分的技术债

如何控制技术债

1、让公司管理层意识到偿还技术债的重要性，从而愿意投入资源

让管理层理解技术债比较直观、有效的方式，就是与经济债务的类比

另外一个办法是，将偿还技术债与业务发展联系起来。如果能够说明某一项技术债已经阻碍了公司重要业务的发展，说服管理层投入资源解决技术债就会比较容易

2、采用低成本的方式去预防

可以使用加强计划和代码审查等方法实现低成本的预防

加强计划，可以帮助开发人员更合理地安排时间，从而有相对充裕的时间去学习并选择更优秀的功能实现方案

代码审查的作用就更好理解了，它可以帮助我们在早期发现一些不必要引入的技术债，以更低的成本去解决它

在接口部分多下功夫。因为接口涉及实现方和多个调用方，所以接口部分累积的技术债，影响范围通常比较大

3、识别技术债并找到可能的解决方案

对于主动引入的技术债，可以在引入的时候就添加任务到 Backlog

对于被动引入的技术债，则需要周期性的审视，这需要技术管理者主动地收集、整理技术债问题

第一是，复杂度相关

在开发时，要时刻注意会增加代码复杂度的“坏味道“，比如，组件间依赖混乱，职责不清晰；组件、文件、函数太大，包含的内容太多；使用不必要的、复杂的设计范式；函数、接口参数太多等；

解决复杂度问题的基本原则是，把一个系统拆解为多个子系统，用抽象和分层的方法，让我们同时只面对有限的信息，并且能够有条理地深入到每一个子系统中查看细节

第二是，重用性相关

软件开发的另一个重要原则是 DRY，即 Don’t repeat yourself。

应用层面，复用业务单元，典型案例就是业务中台

架构层面，复用基础设施后台

组件层面，避免出现责任重叠的组件、数据存储等

代码层面，避免出现重复函数、代码块

4、持续重构，解决高优先级技术债

作为技术管理者，除了业务目标外，还要制定团队的技术目标，来解决最重要、最紧急的技术债任务

技术债任务的具体处理方法有两种：一种是，把技术债的任务和业务相关的任务放到一起，在每一个迭代中持续完成；另一种方法是，采用突击的方式，在某个特定的时间段集中解决技术债问题

 Bug Bash 的工作方式，也就是在每几个迭代以后，专门花几天时间来解决前面遗留下来的 Bug，而不开发新功能

## 高效上云：如何用云计算来提高效能

云计算的特点包括，大规模、分布式、虚拟化、按需服务、高可用、可扩展等。其对研发效能的提升，我觉得主要可以归结为服务化、自助化和弹性

服务化

在服务化方面，云服务按照抽象程度分为 3 类，包括：基础设施即服务 (IaaS)、平台即服务 (PaaS) 和软件即服务 (SaaS)。它们也被称为云计算栈，最下层是 IaaS，最上层是SaaS，越上层的服务越抽象，也就是把下层细节封装的越多，由云平台处理的越多。

云服务商负责的部分就越多，我们就越能够聚焦自己的业务，从而提高研发效能

自助化

用户在使用云上的资源和服务时，尽量减少人工参与，主要采用自动化的方式，比如通过工具或者 API 调用来完成工作。这样一来，既降低了成本，也提高了使用的灵活性和方便性

弹性和共享

云服务的一个基本理念是，把大量的资源集成起来，然后共享给多个客户使用。正是因为多个客户共享资源，所以可以实现单个客户的按需使用。

也就是说，客户 A 不使用资源的时候，可以释放出来供其他用户使用，A 也不必对这部分资源付费。同时，A 在需要大量资源的时候，资源池里通常可以有空闲的资源供它使用。这也就是我们所说的弹性

## 测试左移：测试如何应对新的开发模式

测试左移和右移，就是把测试的范围从传统测试的节点中释放出来，向左和右扩展

向左扩展，就是让测试介入代码提测之前的部分。比如，扩展到开发阶段，在架构设计时就考虑产品的可测试性，并尽量进行开发自测等

测试右移，是让测试介入代码提测之后的部分。比如，测试人员在产品上线过程中，利用线上的真实环境测试。

要做好测试左移，有 3 个基本原则

调整团队对测试的态度

调整团队对测试的态度，打破竖井的工作方式，是测试左移的前提。一个有效的办法是，按照功能的维度管理团队，让整个功能团队对产品负责

也就是说，如果产品质量出现问题，不只是测试团队“背锅”，而是会影响整个功能团队的绩效

另外，还要改变团队成员对测试工作的认知

传统的工作方式中，我们通常认为发现 Bug最重要，但其实为了提高产品质量，更重要的是预防 Bug



测试左移原则二：把测试添加到开发和产品需求步骤中

测试左移的第一步，是把测试工作融入到开发步骤中。常用的办法是，让测试人员参与到开发阶段的方案设计中，了解开发的实现方式

测试左移到了开发阶段之后，再往左移一步就到了产品设计阶段，在这里，测试人员除了解需求外，更重要的是评估需求的质量。

推荐使用 BDD（Behavior Driven Development，行为驱动开发）的方法进行开发，促进团队在需求评审时更多地考虑测试

BDD 是通过特定的框架，用自然语言或类自然语言，按照编写用户故事或者用例的方式，从功能使用者的视角描述并编写测试用例，从而让业务人员、开发人员和测试人员着眼于代码要实现的业务行为，并以此为依据通过测试用例进行验证

测试左移原则三：频繁测试，快速测试

规范化、自动化化本地检查

建设并自动化代码入库前的检查流程

提供快速反馈，促进增量开发

给测试提速的常见办法包括

并行运行。比如把测试用例放到多台机器上运行，用资源换时间。
提高构建速度。比如使用精准构建，因为通常构建之后才能运行测试。
精准测试，也就是只运行跟改动最相关的测试。可以建立需求与代码的关系，以及需求与测试用例的关系，从而在代码改动时重点关注与之最相关的测试用例。
分层测试，即不同情况运行不同测试用例集合。
减少不必要的用例。比如，识别不稳定的用例，对其删除或者优化。

Facebook 使用并开源的Buck系统，可以用来提高构建速度

Google 开源的Bazel，支持精准构建和精准测试

## 蓝绿红黑灰度发布

### 蓝绿部署

蓝绿部署，是采用两个分开的集群对软件版本进行升级的一种方式。它的部署模型中包括一个蓝色集群 A 和一个绿色集群 B，在没有新版本上线的情况下，两个集群上运行的版本是一致的，同时对外提供服务

系统升级时，蓝绿部署的流程

首先，从负载均衡器列表中删除集群 A，让集群 B 单独提供服务。
然后，在集群 A 上部署新版本。
接下来，集群 A 升级完毕后，把负载均衡列表全部指向 A，并删除集群 B，由 A 单独提供服务。
在集群 B 上部署完新版本后，再把它添加回负载均衡列表中

### 红黑部署

与蓝绿部署类似，红黑部署也是通过两个集群完成软件版本的升级。

当前提供服务的所有机器都运行在红色集群 A 中

当需要发布新版本的时候，具体流程是这样的

先在云上申请一个黑色集群 B，在 B 上部署新版本的服务；
等到 B 升级完成后，我们一次性地把负载均衡全部指向 B；
把 A 集群从负载均衡列表中删除，并释放集群 A 中所有机器。

与蓝绿部署相比，红黑部署只不过是充分利用了云计算的弹性伸缩优势，从而获得了两个收益：一是，简化了流程；二是，避免了在升级的过程中，由于只有一半的服务器提供服务，而可能导致的系统过载问题。

### 灰度发布

灰度发布，也被叫作金丝雀发布。与蓝绿部署、红黑部署不同的是，灰度发布属于增量发布方法。也就是说，服务升级的过程中，新旧版本会同时为用户提供服务

在集群的一小部分机器上部署新版本，给一部分用户使用，以测试新版本的功能和性能；确认没有问题之后，再对整个集群进行升级

灰度发布就是把部署好的服务分批次、逐步暴露给越来越多的用户，直到最终完全上线。



究其根本，这些部署、发布方法，是为了解决频繁发布的生产模式带来的两个问题

1、减少发布过程中新旧服务切换造成的服务停止时间。蓝绿部署和红黑部署都能实现无宕机时间部署

2、控制新版本发布因为质量问题带来的风险。灰度发布就是一个例子

## 高效工作：Facebook的10x程序员效率心法

 10x 程序员，也就是 10 倍程序员，意思是一个好的程序员，工作效率可以达到普通程序员的 10 倍

第一条原则：抽象和分而治之

最好的办法是，把一个系统拆分为几个有限的子系统，每个子系统涵盖某一方面的内容，并将其复杂性隐藏起来，只对外暴露关键信息

拆分处理的过程，就是我们常说的分而治之；而用子系统来隐藏一个领域的内部细节，就是抽象

拿到一个任务之后，我们要做的首先就是进行模块的定义，也就是抽象，然后对其分而治之

第二条原则：快速迭代

不要追求完美，不要过度计划，而是要尽快实现功能，通过不断迭代来完善

完成比完美要重要。要实现快速迭代，我们在设计和实现功能时都要注意简单化

在设计的实现中，尽量让自己的代码能够尽快运行起来，从而尽快地验证结果。

为了能够快速进行验证，一个重要实践是设置好本地的代码检验，包括静态扫描、相关单元测试的方便运行，以及 IDE 能够进行的实时检查等。

代码写好之后，尽快提交到主代码仓并保证不会阻塞其他开发人员

第三条原则：DRY

DRY，也就是不要重复你自己

寻找重复的逻辑和代码，进行抽象和封装

寻找流程的重复，使用脚本或者工具自动化

关注团队级别的重复，并对其优化

## 深度工作：聚焦最有价值的事儿

深度工作这个概念，指的是在无干扰的状态下，才能专注地进行的专业活动。这样的活动能够使个人的认知能力发挥到极限，从而让我们创造出最大价值，成为一个不可替代的人

如何实现深度工作

1、以终为始，寻找并聚焦最重要的任务

第一步，自己定义任务

第二步，聚焦目标，以终为始

第三步，无情的筛选，少即是多

“数字 3 原则”很有效，也就是强制把要做的事、要达到的目标，都限制在 3个以内

2、追根究底，寻找最高效的解决方案

在接到任何任务时，都会先考虑它到底要解决什么问题，有没有更好的解决方案，花些时间去深入思考，往往都能帮我们节省后面的很多时间

开发人员也要对业务有一定的了解。面对任务的时候，多问几个 Why，并与产品经理和团队成员充分沟通，了解它到底要解决什么问题，只有这样，我们才能以解决问题为出发点，找到最高效的解决方案

3、安排时间和精力，高效执行解决方案

用番茄工作法来记录深度工作时间

番茄工作法就是把时间划分为固定时长的工作时间和休息时间。一个番茄时间包含两部分，25 分钟的工作学习和 5 分钟的休息时间

番茄工作法的精髓是，在每一个工作时间段，避免干扰、全神贯注。因为只有精力高度集中，减少上下文切换，才能进入深度工作状态，进而最大程度地发挥我们的心智能力，提高个人效能。

用拥抱无聊来控制手机依赖

在一些非常碎片化的时间，不要因为无聊就马上抄起手机，去找一些有意思的东西放松或者学习，而是尝试适应无聊

用反向行事日历来确保休息和高效工作

反向行事日历主要用来处理因为工作太多导致的忽略休息、影响健康和效率低下的问题。

我们在安排日程时，通常会把工作任务放到日历中，而不会把运动、休息、吃饭等非工作任务放入其中。反向日历正好相反，首先就是把这些非工作任务作为最为最高优先级放到日历中，然后再在剩余的时间中安排工作任务

日常操作中的工具和技巧

第一个场景：列举文件夹和文件，查看文件

列举文件的默认工具是 ls。除此之外，一个常用的工具是 tree，可以列出文件夹的树形结构，还有些比 tree 更方便的工具，比如 alder 和 exa。exa 尤其好用

第二个场景：查找并打开文件，进行查看和编辑

上面提到的工具来列出文件名，然后使用 grep 进行过滤查看，或者 VIM 进行查看和编辑

tree -I "node_modules" -f | grep -C3 index.md,可以得到当前文件夹中的所有 index.md 文件。

命令中，tree 的参数 -I，表示排除文件夹 node_modules；tree 的参数 -f，表示显示文件时包含文件路径，方便你拷贝文件的全名；grep 的参数 -C3，代表显示搜索结果 3 行的上下文

Web 访问
我常用的 Web 访问工具是 HTTPie，是 curl 命令的一个补充。HTTPie 的强项在于，专门针对 HTTP 协议，所以可以做到格式简单、易用性强两点。

对 JSON 进行处理

在命令行对 JSON 文本进行处理，最常见的工具是 jq。它能够对 JSON 进行查询和修改处理，功能很强大，cat person.json | jq ".terms[0].office"

另一种类似的工具，直接使用 JavaScript 作为查询处理语言，典型代表是 fx 和 jq.node。这，就大大方便了使用 JavaScript 的开发者，因为可以使用已经熟悉了的语法，cat person-raw.json| fx 'json => json.terms.filter(x => x.type == "top")'

查找、关闭进程
通常情况下，我们使用 kill 和 pkill，来查找和关闭进程。但，使用 fzf 之后，我们可以方便地进行交互式的查找目标进程。具体使用方法是，输入 kill，fzf 就会提供一个交互式的界面供你查找目标进程，然后回车确认即可。

查看日志文件

关于查看日志文件的工具，推荐 lnav。它比 tail -F 要方便、强大得多,有很多很棒的功能，包括：支持很多日志格式，比如 syslog、sudo、uWSGI 等，并可以根据格式高亮显示；支持多个日志同时显示，并用不同颜色区分；支持正则表达式进行过滤等。

命令行本身的实用技巧

关于命令行的使用技巧，有两个非常值得一提：一个是!$，另一个是!!。

第一个!$，代表上一个命令行的最后一个参数

第二个常用的是!!，表示上一个命令的完整命令。

## 效率工具：选对用对才能事半功倍

灵活的工具组合及环境

工具的集成，最值得优化的情况包括两种：一是，使用管道（Pipe）对命令行工具进行集成；二是，对集成开发工具环境（IDE）进行配置，让 IDE 和周边工具集成。

使用管道（Pipe）对命令行工具进行集成

高效使用管道，首先是使用多个管道灵活地把多个工具连接起来。一个常见的场景是，grep 和 xargs 命令的组合。比如，ps aux | grep vim | grep -v grep | awk ‘{print$2}’ 可以找到我当前运行的 VIM 程序并将其关闭。

在命令行中高效使用管道的第二个重要方法，是使用模糊查询工具（Fuzzy Finder)

常见的模糊查询工具，有 fzf、pick、selecta、ctrlp 和 fzy 等。其中，最有名的应该就是fzf

IDE 和周边工具集成

基本的 IDE 集成功能包括：
编码；
构建；
实时检查语法错误；
实时检查编码规格；
运行单元测试，并在测试输出中点击文件名进行跳转；
在本地运行服务，并可以设置断点进行单步调试；
连接远程服务进行单步调试

提高工具一致性

提高工具的一致性，主要方法是减少常用的工作入口，并对这些入口进行优化

命令行、IDE、桌面快捷启动工具、

怎样打造高效团队

技术管理工作主要有如下 3 个步骤

第一步：寻找目标

首先，技术团队的根本目标就是业务目标

业务目标的设定有两个层次：
	弄清楚公司和上级对团队的预期，达到这个预期，是团队的基础目标。
	在基础目标之上，还要给团队设定一个进取目标。我们需要分析公司的发展方向，以及团队的实际情况，找到那些既符合公司利益，又通过跳一跳就能够得着的目标

除了业务目标之外，还有另外一种技术管理者一定要关注的目标，即技术目标

技术目标主要有两种：
	一种是关于偿还技术债的
	另一种是前瞻性的技术目标。作为技术管理者，我们要有灵敏的技术嗅觉，对即将出现的技术挑战，做一些预防和准备

关于技术目标的设定，有两个常见问题：

一是，业务目标和技术目标的时间占比应该是多少？从我个人的经验看，80% 是一个合适的点

二是，技术目标要不要立项？在我看来，这要视公司情况而定。如果你的主管对技术目标认可，那最好能够单独立项；否则，就把技术目标合并到业目标中

第二步：目标管理

SMART 原则。SMART 是 Specific（具体）、Measurable（可衡量）、Attainable（可达成）、Relevant（与主目标有相关性）和 Time-bound（有明确的截止期限）这 5 个英文单词首字母的缩写

OKR 是一个很有用的目标管理工具。

领导者告诉团队需要去哪里，而管理者告诉团队如何去到那里

O 表示目标，是鼓舞人心的目标，可以使每个人保持一致和受到启发；KR 则表示关键结果，是达成目标需要注意的度量

用好 OKR 的两个关键点

第一，使用 OKR 最重要的目的是，让全公司对齐目标，所以在实施 OKR 时，我们要随时留意这个目的

第二，OKR 不是一个 HR 工具，不是绩效管理方法。绩效管理方法一般包括目标、度量和考核（激励 / 惩罚），与之相比，OKR 只包括目标和度量，是一个目标导向工具

第三步：任务执行

关于人：最关键的是调动起主观意愿

统一团队利益的主要方法是，采用康威定律来组织团队结构，使其与产品结构相吻合，让产品的成功成为团队一致的目标

关于流程：选择合适的方法论、原则、实践

具体来说，我推荐使用先从全局的端到端流程入手，寻找系统瓶颈，然后再集中精力解决瓶颈，完成一轮优化

关于工具：根据实践进行选择

让团队根据方法论选择适用的工具即可

第一个原则是，选择工具时要根据场景的复杂程度选择自建还是使用第三方服务 / 工具

第二个原则是，工具虽然重要，但背后的方法论和原则更重要

# 



利用自动化减少重复性工作

利用自动化加强反馈机制

利用研发行为数据改进薄弱环节

保护研发人员的专注力



 3 个维度衡量和分析团队的研发效能

**看交付速率：**单位时间内，团队能够交付多少需求，即需求交付的吞吐量；

**看响应能力：**需求从提出到交付上线的时间长短，即需求交付周期；

**看交付质量：**交付过程中缺陷发现和修复的及时性，以及缺陷数量的多少



DevOps 希望做到的就是持续、快速和高质量的价值交付

度量指标的特征

1、明确受众；定义指标的同时，要定义它所关联的对象，也就是这个指标是给谁看

2、直指问题；好的指标也应该是直指问题的，你一看到这个指标，就能意识到问题所在，并自然而然地进行改进

3、量化趋势；按照 SMART 原则，好的指标应该是可以衡量的，而且是可以通过客观数据来自证的，好的度量指标应该能展现趋势

4、充满张力；指标不应该孤立存在，而是应该相互关联构成一个整体。好的指标应该具有一定的张力，向上可以归并到业务结果，向下可以层层分解到具体细节

部署管理：低风险的部署发布策略.





混沌工程要解决的，就是复杂环境下的分布式系统的反脆弱问题。



是，尽可能在这些故障和缺陷发生之前，通过一系列的实验，在真实环境中验证系统在故障发生时的表现。根据实验的结果来识别风险问题，并且有针对性地进行系统改造和安全加
固，从而提升对于整个系统可用性的信心

在引入混沌工程的实践之前，首先需要确保现有的服务已经具备了弹性模式，并且能够在应急响应预案和自动化工具的支撑下尽早解决可能出现的问题。

混沌工程的原则

1、建立稳定状态的假设

关于系统的稳定状态，就是说，有哪些指标可以证明当前系统是正常的、健康的

与技术指标相比，业务指标更加重要

2、真实世界的事件

我们无法模拟所有的异常事情，投入产出比最高的就是选择重要指标（比如设备可用性、网络延迟，以及各类服务器问题），进行有针对性地实验。

可以结合类似全链路压测等手段，从全局视角测试系统整体运作的可用性，通过和稳定状态的假设指标进行对比，来识别潜在的问题

3、在生产中实验

混沌工程同样鼓励在靠近生产环境的地方进行实验，甚至直接在生产环境中进行实验

在生产环境中进行实验，的确存在风险，这就要求实验范围可控，并且具备随时停止实验的能力。

4、持续的自动化实验

自动化是所有重复性活动的最佳解决方案。通过自动化的实验和自动化结果分析，我们可以保证混沌工程的诸多实践可以低成本、自动化地执行

5、最小的影响范围

混沌工程实践的原则就是不要干扰真实用户的使用

在一开始将实验控制在一个较小的范围内，是非常有必要的，这样可以避免由于实验失控带来的更大问题。



什么能力是团队在推行 DevOps 时最应该具备的？我会毫不犹豫地告诉你，那就是持续改进

Gerrit ：非常流行的代码在线评审和管理工具



DevOps 做到什么程度，就算是实现转型落地了？

核心就是团队已经具备了持续改进的能力，而不只是简简单单地引入了几个工具，建立了几个度量指标而已。

谈到持续改进，有一个非常著名的方法体系，叫作 PDCA，PDCA 是四个英文单词的缩写，也就是 Plan（计划）、Do（实施）、Check（检查）和 Action（行动）

PDCA 提供了一套结构化的实施框架，任何一项改进类工作，都可以划分为这四个实施阶段。通过 PDCA 循环的不断迭代，驱动组织进入一种良性循环，不断识别出新的待改进问题。

针对这些问题，首先要进行根因分析，制定具体的实施计划。然后，不定期地检查实施的结果和预期目标是否一致。最后，要对改进结果进行复盘，把做得好的地方保留下来，把做得不好的地方纳入下一阶段的循环中，继续改进



故障回溯并不一定以确定责任为第一要务，更重要的是，要识别系统流程中的潜在问题和漏洞，并通过后续机制来进行保障，比如增加测试用例、增加产品走查事项等等。其实，大到线上故障，小到日常错误，都值得回溯和总结。

团队实施持续改进的过程，不应该是一次大而全的变革，而应该是一系列小而高频的改进动作

在团队的日常迭代中，事先给改进类工作预留一部分时间，或者是在业务相对不那么繁忙的时候（比如大促刚刚结束，团队在调整状态的时候），在改进工作上多花些时间

在团队的 Backlog 中新增一类任务，专门用于记录和跟踪这类持续改进的内容

在迭代计划会议上，对这类问题进行分析，并预估工作量，保证团队有固定的时间来应对这些问题

对于业务的指标和表现，需要尽可能地在团队内部做到透明，让团队成员可以接触真实世界的用户反馈和评价，以及业务的度量信息。